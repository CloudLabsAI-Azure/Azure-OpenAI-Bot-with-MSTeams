## Lab 3. Deploying the chatbot on Azure Bot Service and Azure App Service.

   In this exercise, you will be deploying the botcode to app service and will be connecting it to the Azure Bot, later you will be integrating it will MS team.
    
### Task 1 : Explore the chatbot codebase to understand user journey and dialogue development

1. You can explore the chatbot codebase under teams-bot directory. There have multiple directory and .env files that we will be updating while performing the lab.
 
    ![](Images/teasmsbotinfo.png)

1. You can also expand the bot folder and you can go through the code for dialog bot and understand how it is working.

    ![](Images/bots2.png)
    
1. You can also review the code under dialogs and undestand the flow.

    ![](Images/bots4.png)

### Task 2 : Update the configuration file with newly generated credentials


1. Navigate back to the Azure machine learning studio, and open a new terminal session.

   ![](Images/terminal.png)
   
1. Run the below commands in the terminal session:

   ```
   cd artifacts/teams-bot
   ```
   
   ```
   vim .env
   ```
   
   ![](Images/vimenv.png)

1. Now you will navigating to the editor window, press **i** to get into the **insert mode**.

   ![](Images/editor.png)
    
1. Replace the values in the **.env** file, you can obtaining the values from **Environment Details (1)** page, under **Service Principal Details (2)**. Then click on **esc** followed by **:wq**.

     - **MicrosoftAppId**= **Application Id (3)**
     - **MicrosoftAppPassword**= **Secret Key (4)**
     - **MicrosoftAppTenantId**= **Tenant Id (Directory id) (5)** 
     - **API_BASE_URL**= **https://openaiwebapp<inject key="DeploymentID" enableCopy="false"/>.azurewebsites.net**
      
          ![](Images/sp-det.png)

1. Then click on **esc** followed by **:wq**.

     ![](Images/wq.png)
 
     
      

### Task 3 : Deploy the chatbot on Azure Bot Service and Azure App Service

1. Within the terminal window run the below mentioned command to create zip folder.

   ```
   zip -r teams-bot.zip .
   ```
   > **Note :** Wait for 15-20 min till the command run successfully.

1. Now, run the below command after updating the `<DID>` with the value **<inject key="DeploymentID" enableCopy="false"/>**.

   ```
   az webapp deploy --resource-group ODL-AzureAI-MS-<DID> --name openaiteamsapp<DID> --src-path teams-bot.zip --type zip
   ```
   
1. After running the command successfully, copy the app URL in a notepad. You will be using it in coming tasks.

   ![](Images/teamsurl1.png)
   

### Task 4: Publish the chatbot on Microsoft Teams channel using a manifest file

1. Navigate back to Azure portal and from the Overview page of resource group select Azure Bot **openai-bot-<inject key="DeploymentID" enableCopy="false"/>**.

    ![](Images/openaibot.png)
    
1. On Azure bot page, follow the below given instructions:

    - Click on  **Configuration (1)**
    - Message endpoint : Enter **httsp://openaiteamsapp<inject key="DeploymentID" enableCopy="false"/>.azurewebsites.net/api/messages**
    - Click on **Apply (3)**

    ![](Images/messageendpoint.png)

1. Click on **Channels (1)** and scroll down to Available channels and select **Microsoft Teams (2)**.

    ![](Images/msteams.png)
    
1. Check the box next to **I agree to the Microsoft Channel Publication Terms and the Microsoft Privacy Statements for my deployment to the Microsoft Teams channels** and click on  **Agree (2)**.

    ![](Images/termsofservice1.png)
    
1. Leave eveything as default on the Microsoft Teams page and click on **Apply**.

    ![](Images/apply.png)
    
1. Once the changes are applied succesfully, click on **Close**.

    ![](Images/close1.png)
    
1. You can view the Microsoft Teams under Channels. Now click on **Open in Teams** URL to open the application.

    ![](Images/openinteams.png)
    
1. On **Microsoft Teams** window, select **Use web app instead**.

    ![](Images/usewebapp.png)
    
1. Send a message **Hi** in the chat **Openai-bot-<inject key="DeploymentID" enableCopy="false"/>**, you will see a response from chat bot and explore through the availble chat bot options.

    ![](Images/chatbot.png)

1. Select **ITSM** option to raise a ticket for any of your own queries.

   ![](Images/itsm.png)
    
1. Now click on **Raise Ticket** and enter the query.

    ![](Images/ticket.png)
  
1. To check the status of the ticket click on **Check Ticket Status**.

    ![](Images/ticket2.png)

1. Now choose **QnA** option on the teams chat.

    ![](Images/qna.png)
    
1. On **Select knowledge base from below** tab, choose the **jira-faq (1)** document and click on **Submit (2)**.

    ![](Images/jira.png)
    
1. Enter the below query and review the reply provided by the bot.

    ```
    Who are agents in Jira Jira Service Management?
    ```
    
    ![](Images/jira1.png)
    
1. If you want to restart the bot, enter **Restart** and hit enter.

    ![](Images/restart1.png)
